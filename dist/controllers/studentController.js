"use strict";var path=require("path"),xtpl=require("xtpl"),databaseManger=require(path.join(__dirname,"../tools/databaseManger.js"));exports.getStudentListPage=function(e,t){var n=e.query.keyword||"";databaseManger.find("studentInfo",{name:{$regex:n}},function(a,d){xtpl.renderFile(path.join(__dirname,"../views/list.html"),{studentList:d,loginedname:e.session.username,keyword:n},function(e,n){t.send(n)})})},exports.getAddStudentPage=function(e,t){xtpl.renderFile(path.join(__dirname,"../views/add.html"),{loginedname:e.session.username},function(e,n){t.send(n)})},exports.AddStudent=function(e,t){databaseManger.insertOne("studentInfo",e.body,function(e,n){e?alert("添加失败"):t.send('<script>location.href="/student/list"<\/script>')})},exports.getEditStudentPage=function(e,t){var n=databaseManger.ObjectId(e.params.studentId);databaseManger.findOne("studentInfo",{_id:n},function(n,a){xtpl.renderFile(path.join(__dirname,"../views/edit.html"),{student:a,loginedname:e.session.username},function(e,n){t.send(n)})})},exports.editStudent=function(e,t){var n=databaseManger.ObjectId(e.params.studentId);databaseManger.updateOne("studentInfo",{_id:n},e.body,function(e,n){e?alert("修改失败"):t.send('<script>location.href="/student/list"<\/script>')})},exports.delStudent=function(e,t){var n=databaseManger.ObjectId(e.params.studentId);databaseManger.del("studentInfo",{_id:n},function(e,n){e?alert("删除失败"):t.send('<script>location.href="/student/list"<\/script>')})};